LeftGroupBox:AddToggle("AutoFarm", {
	Text = "Auto Farm (Step by Step)",
	Default = false,
	Tooltip = "Menjalankan langkah satu per satu berurutan",
	Callback = function(Value)
		if Value then
			task.spawn(function()
				local stepIndex = 1
				while Toggles.AutoFarm.Value do
					pcall(function()
						if stepIndex == 1 then
							-- Step 1: Computer
							for _, m in pairs(workspace:GetChildren()) do
								local c = m:FindFirstChild("computer2") and m.computer2:FindFirstChild("Cube")
								if c then
									tp(c.Position + Vector3.new(0, 2, 0))
									fire(c:FindFirstChildWhichIsA("ProximityPrompt", true))
									stepIndex = 2
									break
								end
							end

						elseif stepIndex == 2 then
							-- Step 2: Printer
							local pr = workspace:FindFirstChild("Printerpharmacy")
							if pr and pr:FindFirstChild("Union2") then
								local u = pr.Union2
								tp(u.Position + Vector3.new(0, 2, 0))
								fire(u:FindFirstChildWhichIsA("ProximityPrompt", true))
								stepIndex = 3
							end

						elseif stepIndex == 3 then
							-- Step 3: Grab Meds
							local s = workspace["Finno_992 | Stocked Pharmacy Shelving"]
							local fs = s and s:FindFirstChild("Model") and s.Model:FindFirstChild("FSAtchciken")
							local found = false

							if fs then
								for _, t in pairs(p.Backpack:GetChildren()) do
									if t:IsA("Tool") and t.Name:match("Order") then
										equip(t)
										for _, a in pairs(fs:GetDescendants()) do
											if a:IsA("Attachment") and a.Parent:IsA("BasePart") then
												for _, pp in pairs(a:GetChildren()) do
													if pp:IsA("ProximityPrompt") and pp.ActionText then
														local m = pp.ActionText:match("Grab (.+)"):gsub(" Meds", "")
														if t.Name == m .. " Order" then
															tp(a.WorldPosition + Vector3.new(0, 2, 0) + a.Parent.CFrame.LookVector * 2.5)
															fire(pp)
															repeat task.wait(0.2) until p.Backpack:FindFirstChild("Medication") or p.Character:FindFirstChild("Medication")
															unequip()
															found = true
															break
														end
													end
												end
											end
											if found then break end
										end
										if found then
											stepIndex = 4
											break
										end
									end
								end
							end

						elseif stepIndex == 4 then
							-- Step 4: Submit Medication
							local med = p.Backpack:FindFirstChild("Medication")
							if med then
								equip(med)
								local desk = workspace:FindFirstChild("Finno_992 | Pharmacy Front-Desk")
								local tray = desk and desk:FindFirstChild("Pill Counting Tray")
								local base = tray and tray:FindFirstChild("Base")
								if base then
									for _, u in pairs(base:GetChildren()) do
										local pp = u:IsA("BasePart") and u:FindFirstChildWhichIsA("ProximityPrompt", true)
										if pp then
											tp(u.Position + Vector3.new(0, 2, 0))
											fire(pp)
											stepIndex = 5
											break
										end
									end
								end
							end

						elseif stepIndex == 5 then
							-- Step 5: Tube System
							local tool = p.Backpack:FindFirstChild("Meds")
							if tool then
								equip(tool)
								local nearestTube = nil
								local shortest = math.huge
								local hrp = p.Character and p.Character:FindFirstChild("HumanoidRootPart")

								if hrp then
									for _, t in pairs(workspace:GetChildren()) do
										if t:IsA("Model") and t.Name == "Tubesystem" and t:FindFirstChild("Union") then
											local dist = (t.Union.Position - hrp.Position).Magnitude
											if dist < shortest then
												shortest = dist
												nearestTube = t
											end
										end
									end

									if nearestTube then
										local union = nearestTube:FindFirstChild("Union")
										if union then
											tp(union.Position + Vector3.new(0, 2, 0))
											fire(union:FindFirstChildWhichIsA("ProximityPrompt", true))
											stepIndex = 1 -- Ulang ke awal
										end
									end
								end
							end
						end
					end)
					task.wait(0.5)
				end
			end)
		end
	end,
})
