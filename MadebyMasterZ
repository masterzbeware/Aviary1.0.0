local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

local Options = Library.Options
local Toggles = Library.Toggles

local Window = Library:CreateWindow({
    Title = "MasterZ Toggle GUI",
    Footer = "v1.0.0",
    Icon = 0,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

local Tabs = {
    Main = Window:AddTab("Main", "toggle-left"),
}

local GroupBox = Tabs.Main:AddLeftGroupbox("Toggle Section")

-- Flag kontrol autofarm
local autofarmRadiology = false

-- Fungsi utama autofarm
local function startRadiologyAutofarm()
    local TweenService = game:GetService("TweenService")
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    -- Fungsi tween ke part tertentu
    local function tweenTo(part)
        if not part then return end
        local goal = { CFrame = part.CFrame + Vector3.new(0, 3, 0) }
        local tween = TweenService:Create(hrp, TweenInfo.new(1, Enum.EasingStyle.Linear), goal)
        tween:Play()
        tween.Completed:Wait()
    end

    -- Ambil RadiologyRoom1 pertama
    local rooms = workspace:WaitForChild("RadiologyRooms"):GetChildren()
    local selectedRoom
    for _, room in ipairs(rooms) do
        if room:IsA("Model") and room.Name == "RadiologyRoom1" then
            selectedRoom = room
            break
        end
    end

    if not selectedRoom then
        warn("Tidak ada RadiologyRoom1 ditemukan.")
        return
    end

    -- Cari Part dengan ClickDetector
    local clickPart
    local xrayMachine = selectedRoom:FindFirstChild("X-Ray (with CXR and table) Machine", true)
    if xrayMachine then
        local sub = xrayMachine:FindFirstChild("X-Ray Machine")
        if sub then
            for _, obj in ipairs(sub:GetDescendants()) do
                if obj:IsA("ClickDetector") then
                    clickPart = obj.Parent
                    break
                end
            end
        end
    end

    if not clickPart then
        warn("ClickDetector tidak ditemukan.")
        return
    end

    -- Tween ke Part & trigger ClickDetector
    tweenTo(clickPart)
    for i = 1, 5 do
        if not autofarmRadiology then return end
        pcall(function()
            fireclickdetector(clickPart:FindFirstChildWhichIsA("ClickDetector"))
        end)
        wait(0.5)
    end

    -- Tunggu sampai ProximityPrompt di X-Ray Button aktif
    local xrayBtn = selectedRoom:FindFirstChild("X-Ray Button")
    local prompt
    if xrayBtn then
        for _, part in ipairs(xrayBtn:GetChildren()) do
            local p = part:FindFirstChildWhichIsA("ProximityPrompt")
            if p then
                prompt = p
                break
            end
        end
    end

    if not prompt then
        warn("ProximityPrompt di X-Ray Button tidak ditemukan.")
        return
    end

    -- Tunggu sampai Prompt aktif
    repeat
        if not autofarmRadiology then return end
        print("Menunggu ProximityPrompt aktif...")
        task.wait(0.5)
    until prompt.Enabled

    print("✅ Prompt aktif! Siap ke langkah berikutnya.")
end

-- Toggle untuk mengaktifkan / menonaktifkan autofarm radiology
GroupBox:AddToggle("RadiologyToggle", {
    Text = "Autofarm Radiology (ruangan pertama)",
    Default = false,
    Tooltip = "Tween + ClickDetector hingga Prompt aktif di RadiologyRoom1 pertama",
    Callback = function(value)
        autofarmRadiology = value
        if value then
            task.spawn(startRadiologyAutofarm)
        else
            print("❌ Autofarm dimatikan.")
        end
    end
})

-- Theme & Save Manager setup
Library.ToggleKeybind = Options.MenuKeybind
ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({ "MenuKeybind" })

ThemeManager:SetFolder("MyScriptHub")
SaveManager:SetFolder("MyScriptHub/specific-game")
SaveManager:SetSubFolder("specific-place")
SaveManager:BuildConfigSection(Tabs.Main)
ThemeManager:ApplyTheme("Mocha")
