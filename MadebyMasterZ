local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()

local Toggles = Library.Toggles

local Window = Library:CreateWindow({
    Title = "Radiology Autofarm",
    Footer = "by MasterZ",
    Icon = 0,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

local Tabs = {
    Main = Window:AddTab("Main", "toggle-left"),
}

local GroupBox = Tabs.Main:AddLeftGroupbox("Autofarm")

local autofarmRadiology = false

GroupBox:AddToggle("RadiologyToggle", {
    Text = "Autofarm Radiology (Looping)",
    Default = false,
    Tooltip = "Menjalankan seluruh langkah radiology berulang-ulang.",
    Callback = function(value)
        autofarmRadiology = value
        if value then
            task.spawn(function()
                local TweenService = game:GetService("TweenService")
                local Players = game:GetService("Players")
                local player = Players.LocalPlayer

                local function tweenTo(part)
                    if not part then return end
                    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    if not hrp then return end
                    local goal = { CFrame = part.CFrame + Vector3.new(0, 3, 0) }
                    local tween = TweenService:Create(hrp, TweenInfo.new(1, Enum.EasingStyle.Linear), goal)
                    tween:Play()
                    tween.Completed:Wait()
                end

                local function equipTool(name)
                    local tool = player.Backpack:FindFirstChild(name)
                    if not tool then
                        repeat
                            task.wait(0.5)
                            tool = player.Backpack:FindFirstChild(name)
                        until tool or not autofarmRadiology
                    end
                    if tool and player.Character then
                        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                        if humanoid then
                            humanoid:EquipTool(tool)
                        end
                    end
                end

                while autofarmRadiology do
                    local char = player.Character or player.CharacterAdded:Wait()
                    local room = workspace:WaitForChild("RadiologyRooms"):FindFirstChild("RadiologyRoom1")
                    if not room then warn("RadiologyRoom1 not found.") break end

                    local machineRoot = room:FindFirstChild("X-Ray (with CXR and table) Machine", true)

                    -- Step 1: Wedgera
                    tweenTo(room:FindFirstChild("Wedgera", true))

                    -- Step 2: Trigger ClickDetector
                    local xrayMachine = machineRoot and machineRoot:FindFirstChild("X-Ray Machine")
                    local clickPart
                    if xrayMachine then
                        for _, obj in ipairs(xrayMachine:GetDescendants()) do
                            if obj:IsA("ClickDetector") then
                                clickPart = obj.Parent
                                break
                            end
                        end
                    end

                    local xrayBtnPrompt
                    local xrayBtn = room:FindFirstChild("X-Ray Button")
                    if xrayBtn then
                        for _, part in ipairs(xrayBtn:GetChildren()) do
                            local p = part:FindFirstChildWhichIsA("ProximityPrompt")
                            if p then
                                xrayBtnPrompt = p
                                break
                            end
                        end
                    end

                    while autofarmRadiology and xrayBtnPrompt and not xrayBtnPrompt.Enabled do
                        pcall(function()
                            fireclickdetector(clickPart:FindFirstChildWhichIsA("ClickDetector"))
                        end)
                        task.wait(0.5)
                    end

                    -- Step 3: radiologycomputer2
                    local computer = room:FindFirstChild("radiologycomputer2")
                    if computer then
                        tweenTo(computer)
                        local prompt = computer:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 4: Attachment Prompt
                    for _, part in ipairs(room:GetChildren()) do
                        if part:IsA("BasePart") then
                            local att = part:FindFirstChildWhichIsA("Attachment", true)
                            if att then
                                local prompt = att:FindFirstChildWhichIsA("ProximityPrompt", true)
                                if prompt then
                                    tweenTo(part)
                                    fireproximityprompt(prompt)
                                    break
                                end
                            end
                        end
                    end

                    -- Step 5: Equip Wedge → Torso
                    equipTool("Wedge")
                    local torso = room:FindFirstChild("PatientRadiology", true)
                    torso = torso and torso:FindFirstChild("Torso")
                    if torso then
                        tweenTo(torso)
                        local prompt = torso:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 6: dd
                    local dd = machineRoot and machineRoot:FindFirstChild("X-Ray Table")
                    dd = dd and dd:FindFirstChild("Table")
                    dd = dd and dd:FindFirstChild("dd")
                    if dd then
                        tweenTo(dd)
                        local prompt = dd:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 7: X-Ray Button
                    if xrayBtn then
                        for _, part in ipairs(xrayBtn:GetChildren()) do
                            local prompt = part:FindFirstChildWhichIsA("ProximityPrompt", true)
                            if prompt then
                                tweenTo(part)
                                fireproximityprompt(prompt)
                                break
                            end
                        end
                    end

                    task.wait(4)

                    -- Step 8: Computer lagi
                    if computer then
                        tweenTo(computer)
                        local prompt = computer:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 9: Torso lagi
                    if torso then
                        tweenTo(torso)
                        local prompt = torso:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 10: Sheet
                    local sheet = machineRoot and machineRoot:FindFirstChild("X-Ray Table")
                    sheet = sheet and sheet:FindFirstChild("Table")
                    sheet = sheet and sheet:FindFirstChild("Sheet")
                    if sheet then
                        tweenTo(sheet)
                        local prompt = sheet:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 11: krim2
                    local krim2 = room:FindFirstChild("Closet", true)
                    krim2 = krim2 and krim2:FindFirstChild("krim2")
                    if krim2 then
                        tweenTo(krim2)
                        local att = krim2:FindFirstChildWhichIsA("Attachment", true)
                        if att then
                            local prompt = att:FindFirstChildWhichIsA("ProximityPrompt", true)
                            if prompt then fireproximityprompt(prompt) end
                        end
                    end

                    -- Step 12: Equip clean sheet
                    equipTool("clean sheet")

                    -- Step 13: Sheet ulang
                    if sheet then
                        tweenTo(sheet)
                        local prompt = sheet:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Step 14: Torso final
                    if torso then
                        tweenTo(torso)
                        local prompt = torso:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then fireproximityprompt(prompt) end
                    end

                    -- Tunggu sebentar sebelum ulangi siklus
                    task.wait(2)
                end
            end)
        else
            print("❌ Autofarm Radiology dimatikan.")
        end
    end
})
