-- Ganti dengan nama pemain asli yang ingin diikuti
local ClientName = "NamaPemainAsli"

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local PathfindingService = game:GetService("PathfindingService")

local localPlayer = Players.LocalPlayer
local client = nil
local follow = false
local baris = false

local humanoid = nil
local character = nil

-- Debug
local function debugPrint(msg)
	print("[DEBUG] " .. msg)
end

-- Fungsi update referensi karakter
local function updateCharacterRefs()
	character = localPlayer.Character
	if character then
		humanoid = character:FindFirstChildOfClass("Humanoid")
	end
end

-- Fungsi untuk buat bot jalan kaki ke targetPos
local function moveToPosition(targetPos)
	if not humanoid then return end

	local path = PathfindingService:CreatePath({
		AgentRadius = 2,
		AgentHeight = 5,
		AgentCanJump = true,
		AgentCanClimb = true,
	})

	path:ComputeAsync(character.HumanoidRootPart.Position, targetPos)

	if path.Status == Enum.PathStatus.Complete then
		for _, waypoint in ipairs(path:GetWaypoints()) do
			humanoid:MoveTo(waypoint.Position)
			humanoid.MoveToFinished:Wait()
		end
	else
		debugPrint("Path gagal ditemukan.")
	end
end

-- Fungsi follow client dari belakang (5 studs)
local function followClient()
	if not client or not client.Character or not character then
		debugPrint("Follow gagal: karakter belum siap")
		return
	end

	local targetHrp = client.Character:FindFirstChild("HumanoidRootPart")
	local myHrp = character:FindFirstChild("HumanoidRootPart")
	if not targetHrp or not myHrp then return end

	local followPos = targetHrp.Position - targetHrp.CFrame.LookVector * 5
	moveToPosition(followPos)
end

-- Fungsi baris (berdiri di belakang client 3 studs)
local function barisFormasi()
	if not client or not client.Character or not character then return end

	local targetHrp = client.Character:FindFirstChild("HumanoidRootPart")
	local myHrp = character:FindFirstChild("HumanoidRootPart")
	if not targetHrp or not myHrp then return end

	local barisPos = targetHrp.Position - targetHrp.CFrame.LookVector * 3
	moveToPosition(barisPos)
end

-- Pantau semua chat pemain
local function onPlayerAdded(player)
	if player.Name == ClientName then
		client = player
		debugPrint("Client ditemukan: " .. client.Name)

		player.Chatted:Connect(function(message)
			if message == "!ikuti" then
				follow = true
				baris = false
				debugPrint("Perintah diterima: !ikuti")
			elseif message == "!baris" then
				baris = true
				follow = false
				debugPrint("Perintah diterima: !baris")
			else
				debugPrint("Pesan dari client: " .. message)
			end
		end)
	end
end

-- Cek semua pemain yang sudah ada
for _, player in pairs(Players:GetPlayers()) do
	onPlayerAdded(player)
end

-- Deteksi pemain baru
Players.PlayerAdded:Connect(onPlayerAdded)

-- Deteksi saat karakter bot respawn
localPlayer.CharacterAdded:Connect(function()
	debugPrint("Karakter bot respawn.")
	updateCharacterRefs()
end)

-- Update referensi awal
updateCharacterRefs()

-- Loop per 1 detik untuk update gerakan (tidak terlalu sering)
while true do
	task.wait(1)
	if follow then
		followClient()
	elseif baris then
		barisFormasi()
	end
end
