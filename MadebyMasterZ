-- Ganti dengan nama pemain yang jadi client
local ClientName = "akunoctora"

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local PathfindingService = game:GetService("PathfindingService")

local localPlayer = Players.LocalPlayer
local client = nil
local follow = false
local baris = false

local humanoid
local myRootPart

-- Fungsi update referensi karakter bot
local function updateBotRefs()
	local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
	humanoid = character:WaitForChild("Humanoid")
	myRootPart = character:WaitForChild("HumanoidRootPart")
end

-- Debug log
local function debugPrint(msg)
	print("[DEBUG] " .. msg)
end

-- Fungsi untuk buat bot jalan kaki ke targetPos
local function moveTo(targetPos)
	if not humanoid or not myRootPart then return end

	local path = PathfindingService:CreatePath({
		AgentRadius = 2,
		AgentHeight = 5,
		AgentCanJump = true,
		AgentCanClimb = true,
	})
	path:ComputeAsync(myRootPart.Position, targetPos)

	if path.Status == Enum.PathStatus.Complete then
		for _, waypoint in ipairs(path:GetWaypoints()) do
			humanoid:MoveTo(waypoint.Position)
			humanoid.MoveToFinished:Wait()
		end
	else
		debugPrint("Gagal mencari jalan.")
	end
end

-- Fungsi jalan ke belakang client (jarak 5 studs)
local function followClient()
	if not client or not client.Character or not humanoid then return end

	local targetRoot = client.Character:FindFirstChild("HumanoidRootPart")
	if not targetRoot then return end

	local followPosition = targetRoot.Position - targetRoot.CFrame.LookVector * 5
	moveTo(followPosition)
end

-- Fungsi jalan ke posisi baris (jarak 3 studs di belakang)
local function barisFormasi()
	if not client or not client.Character or not humanoid then return end

	local targetRoot = client.Character:FindFirstChild("HumanoidRootPart")
	if not targetRoot then return end

	local barisPosition = targetRoot.Position - targetRoot.CFrame.LookVector * 3
	moveTo(barisPosition)
end

-- Saat client join atau ditemukan
local function handleClient(player)
	if player.Name ~= ClientName then return end
	client = player
	debugPrint("Client ditemukan: " .. player.Name)

	-- Dengarkan perintah chat
	player.Chatted:Connect(function(message)
		if message == "!ikuti" then
			follow = true
			baris = false
			debugPrint("Perintah !ikuti diterima")
		elseif message == "!baris" then
			baris = true
			follow = false
			debugPrint("Perintah !baris diterima")
		end
	end)
end

-- Pantau semua pemain
for _, p in ipairs(Players:GetPlayers()) do
	handleClient(p)
end

Players.PlayerAdded:Connect(handleClient)

-- Update saat karakter bot spawn
localPlayer.CharacterAdded:Connect(function()
	debugPrint("Karakter bot muncul.")
	updateBotRefs()
end)

-- Inisialisasi awal
updateBotRefs()

-- Loop tiap 1 detik biar bot tidak spam jalan
while true do
	task.wait(1)

	if follow then
		followClient()
	elseif baris then
		barisFormasi()
	end
end
