local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

local Options = Library.Options
local Toggles = Library.Toggles

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

local Window = Library:CreateWindow({
    Title = "MasterZ Toggle GUI",
    Footer = "v1.0.0",
    Icon = 0,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

local Tabs = {
    Main = Window:AddTab("Main", "toggle-left"),
}

local GroupBox = Tabs.Main:AddLeftGroupbox("Toggle Section")

-- Toggle utama
GroupBox:AddToggle("CTAutoFarm", {
    Text = "Auto CT Radiology",
    Default = false,
    Tooltip = "Teleport ke Torso dan trigger prompt",
    Callback = function(value)
        if value then
            CTLoop = task.spawn(function()
                while Toggles.CTAutoFarm.Value do
                    local rooms = game.Workspace:WaitForChild("CTRooms"):GetChildren()

                    -- Ambil model acak dari CTRooms
                    local selectedRoom = nil
                    for _, room in ipairs(rooms) do
                        if room:IsA("Model") and room:FindFirstChild("PatientRadiology2") then
                            selectedRoom = room
                            break
                        end
                    end

                    if selectedRoom then
                        local torso = selectedRoom.PatientRadiology2:FindFirstChild("Torso")
                        if torso and torso:IsA("BasePart") then
                            -- Tween ke posisi torso
                            local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
                            local tween = TweenService:Create(HumanoidRootPart, tweenInfo, {CFrame = torso.CFrame + Vector3.new(0, 3, 0)})
                            tween:Play()
                            tween.Completed:Wait()

                            -- Tunggu sedikit sebelum trigger
                            task.wait(1)

                            -- Trigger ProximityPrompt jika ada
                            local prompt = torso:FindFirstChildOfClass("ProximityPrompt")
                            if prompt then
                                fireproximityprompt(prompt)
                            end
                        end
                    end

                    task.wait(3) -- Delay antar loop
                end
            end)
        else
            if CTLoop then
                task.cancel(CTLoop)
            end
        end
    end
})

-- Setup theme dan save manager
Library.ToggleKeybind = Options.MenuKeybind
ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({ "MenuKeybind" })

ThemeManager:SetFolder("MyScriptHub")
SaveManager:SetFolder("MyScriptHub/specific-game")
SaveManager:SetSubFolder("specific-place")
